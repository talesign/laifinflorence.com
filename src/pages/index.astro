---
import '../styles/global.css';
import Layout from "@/layouts/main.astro"
import HeroHome from '@/components/sections/homepage/hero';
import ResultSection from '@/components/sections/homepage/results';
import ServicesDisplay from '@/components/sections/homepage/services';
import AboutSection from '@/components/sections/homepage/about'
import { getCollection } from "astro:content";
import { getImage } from 'astro:assets';
const servicesCollection = await getCollection("services", ({ data }) => {
  return data.featured === true
});

// const file = (await Astro.glob("../content/home.md"))[0]
// file.frontmatter.seo_title
const homeContent = (await getCollection("home"))[0]

const servicesWithImage = await Promise.all(
  servicesCollection.map(async (service) => {
    const imageAttrs = await getImage({
      src: service.data.image,
      alt: service.data.title,
      width: 600,
      height: 600,
      aspectRatio: '16:9',
      format: 'webp',
    });
    return {
      ...service,
        images: {
          listing: imageAttrs
        }
      }
  })
)

const content = {
  title: homeContent.data.seo_title,
  description: "sandro"
}

---
<Layout content={content}>
  <HeroHome />
  <ResultSection />
  <ServicesDisplay client:load services={servicesWithImage} />
  <AboutSection />
</Layout>
